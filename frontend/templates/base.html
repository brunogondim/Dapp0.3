<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Cartesi DApp</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap-5.1.3-dist/css/bootstrap.min.css') }}">
    <script src="../static/node_modules/web3/dist/web3.min.js"></script>
</head>
<body>
  <nav class="navbar navbar-expand-md navbar-dark" style="background-color: #1c649e;">
    <div class="container-fluid">
      <div class="navbar-collapse collapse w-100 order-1 order-md-0 dual-collapse2">
        <a class="navbar-brand px-3">
          <img src="static/logocartesi.png" width="30" height="30" alt="">
        </a>
        <a class="navbar-brand" href="/index">SQLite DApp</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <ul class="navbar-nav me-auto">
          <li class="nav-item">
            <a class="nav-link" href="/insert">Insert</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/select">Search</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/update">Update</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/delete">Delete</a>
          </li>
        </ul>
      </div>
      <div class="navbar-collapse collapse w-100 order-3 dual-collapse2">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <!-- <input type="image" src="../static/MetaMask_Icon.png" width="40" height="40" onclick="connect();"/> -->
            <img src="../static/MetaMask_Icon.png" width="40" height="40"/> 
          </li>
          <li class="nav-item">
            <button class="btn btn-primary btn-sm" id="metamaskButton", style="background-color: #d67a02;">Connect to Metamask</button>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  

  <div class="col-xs-12" style="height:30px;"></div>


  {% with success = get_flashed_messages(category_filter=["success"]) %}
  {% if success %}
  <div class="alert alert-success">
    <ul>
      {%- for msg in success %}
      <li>{{ msg }}</li>
      {% endfor -%}
    </ul>
  </div>
  {% endif %}
  {% endwith %}


  {% block content %}
  {% endblock content %}

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="{{ url_for('static', filename='bootstrap-5.1.3-dist/js/bootstrap.min.js') }}"></script>
    <script type="text/javascript">
      var provider = window.ethereum
      var metamaskButton = document.getElementById('metamaskButton')

      async function run(){
        if (!provider){
          metamaskButton.innerText = "Install Metamask"
        }
        else{
          let accounts = await provider.request({method: 'eth_accounts'})
          if (accounts.length == 0){
            metamaskButton.innerText = "Connect to Metamask"
            metamaskButton.addEventListener('click', connect)
          }
          else{
            metamaskButton.innerText = accounts[0]
          }
        }
      }

      async function connect(){
        const accounts = await provider.request({method: 'eth_requestAccounts'})
        metamaskButton.innerText = accounts[0]
        metamaskButton.removeEventListener('click', connect)
      }

      run();

      // async function addinput(){
      //   const web3 = await new Web3(window.ethereum);
      //   let accounts = await web3.eth.getAccounts();
      //   user_account = accounts[0]
      //   console.log(user_account)
      //   let input_contract = await new web3.eth.Contract(input_file.abi, rollups_address)
      //   let receipt = await input_contract.methods.addInput().send({from: user_account})
      // }

    </script>
</body>
</html>